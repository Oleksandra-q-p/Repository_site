<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Кешування та оптимізація</title>
  <style>
    :root {
      --dark-green: #10403B;
      --soft-green: #8AA6A3;
      --text-dark: #4C5958;
    }

    body {
      font-family: sans-serif;
      margin: 2rem;
      background: var(--soft-green);
      color: var(--text-dark);
      transition: 0.3s;
    }

    .dark-mode {
      background: var(--dark-green);
      color: #eee;
    }

    form, input, button {
      margin-bottom: 1rem;
    }

    input {
      padding: 0.4rem;
      border: 1px solid var(--text-dark);
      border-radius: 4px;
    }

    button {
      background-color: var(--dark-green);
      color: #fff;
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    button:hover {
      background-color: #0c322e;
    }

    .gallery {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .gallery img {
      width: 200px;
      height: auto;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>

  <h1>Налаштування кешування та стиснення</h1>

  <form id="userForm">
    <label for="username">Ім’я користувача:</label><br>
    <input type="text" id="username" name="username">
    <button type="submit">Зберегти</button>
  </form>

  <button id="toggleTheme">Перемкнути тему</button>

  <h2>Галерея зображень</h2>
  <div class="gallery" id="gallery"></div>

  <script>
    // LocalStorage: збереження даних форми
    const form = document.getElementById('userForm');
    const usernameInput = document.getElementById('username');
    form.addEventListener('submit', function(e) {
      e.preventDefault();
      localStorage.setItem('username', usernameInput.value);
      alert('Ім’я збережено!');
    });

    // Відновлення з localStorage
    window.addEventListener('load', () => {
      const savedName = localStorage.getItem('username');
      if (savedName) usernameInput.value = savedName;

      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'dark') document.body.classList.add('dark-mode');
    });

    // Користувацьке налаштування: тема
    document.getElementById('toggleTheme').addEventListener('click', () => {
      document.body.classList.toggle('dark-mode');
      const theme = document.body.classList.contains('dark-mode') ? 'dark' : 'light';
      localStorage.setItem('theme', theme);
    });

    // Кешування зображень
    const cache = new Map();
    const gallery = document.getElementById('gallery');
    const imageURLs = [
      'https://images.unsplash.com/photo-1602526213894-d04d78b0f2d5?w=400',
      'https://images.unsplash.com/photo-1503023345310-bd7c1de61c7d?w=400',
      'https://images.unsplash.com/photo-1525182008055-f88b95ff7980?w=400'
    ];

    function loadImage(url) {
      if (cache.has(url)) {
        return Promise.resolve(cache.get(url));
      }
      return fetch(url)
        .then(res => res.blob())
        .then(blob => {
          const imgURL = URL.createObjectURL(blob);
          cache.set(url, imgURL);
          return imgURL;
        });
    }

    imageURLs.forEach(url => {
      loadImage(url).then(imgURL => {
        const img = document.createElement('img');
        img.src = imgURL;
        img.loading = 'lazy';
        img.alt = 'Зображення';
        gallery.appendChild(img);
      });
    });
  </script>

</body>
</html>
